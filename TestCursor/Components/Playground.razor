@page "/scrollabletextbox"
@using AiAgent
@using Products
@rendermode InteractiveServer
@using Markdig

<h3>Playground</h3>

<PageTitle>Scrollable TextBox</PageTitle>

<h3>Products</h3>

<textarea class="form-control" style="height: 50px; margin-bottom: 20px;" readonly>@textBoxContent</textarea>

<h3>Recommendations</h3>
<div class="form-control" style="height: 800px; overflow-y: auto;">
    @aiResponseHtml
</div>

<button class="btn btn-primary" @onclick="GetAllProducts">Get All Products</button>
<button class="btn btn-secondary" @onclick="SendToAI">Send to AI</button>

@code {
    private string textBoxContent = "No Data Yet";
    private string aiResponseContent = "No AI Response Yet";
    private MarkupString aiResponseHtml;

    [Inject]
    private IProcessProducts ProcessProducts { get; set; }

    [Inject]
    private IAiAgent AiAgent { get; set; }

    private async Task GetAllProducts()
    {
        textBoxContent = "Fetching all products...";
        var products = ProcessProducts.GetAllProducts();
        textBoxContent = string.Join("\n", products);
    }

    private async Task SendToAI()
    {
        aiResponseContent = "Sending data to AI...";
        var response = AiAgent.QueryAgent(textBoxContent);
        aiResponseContent = response;
        aiResponseHtml = new MarkupString(Markdown.ToHtml(aiResponseContent));
    }
}
